import{a as we,b as K}from"./index-1e985a02.js";/* empty css                *//* empty css                 *//* empty css                     *//* empty css                  */import{l as L,r as f,M as ke,L as V,z as n,A as p,B as t,C as a,D as s,a5 as r,ay as Ve,O as N,az as xe,R as h,ab as x,ac as E,n as Ee,K as Ce,aa as ze,au as Ue,aA as Re,an as Te,ah as Pe,ai as De,aB as Me,av as Se,Q as Fe,u as b,J as H,Y as _,aj as Le,aC as je,aD as Oe,aE as le,P as J,H as ae,aF as Be,aG as Ie,ap as $e,am as Ae,aH as Ke,ao as Ne,at as He,as as Je,aI as Qe,aJ as qe,aK as Ge,aL as Ye}from"./element-plus-ec4a33e2.js";import"./echarts-6d655a86.js";import{_ as We,L as Q}from"./leaflet-f9f0bb1a.js";const Xe={class:"explore-view"},Ze={class:"explore-container"},el={class:"card"},ll={class:"card-header"},al={class:"card-title"},tl={class:"card-body"},sl={class:"search-section"},ol={class:"advanced-filters"},nl={class:"filter-row"},il={class:"filter-actions"},rl={class:"card"},dl={class:"card-header"},ul={class:"card-title"},cl={class:"table-controls"},_l={class:"card-body"},pl={key:0},vl={class:"restaurant-name-cell"},ml={class:"stars-display"},fl={key:1,class:"text-gray"},bl={key:1,class:"restaurant-cards"},gl={class:"cards-grid"},yl=["onClick"],hl={class:"card-header"},wl={class:"card-title"},kl={class:"card-content"},Vl={key:0},xl={class:"card-actions"},El={class:"pagination-container"},Cl={key:0,class:"restaurant-details"},zl={class:"restaurant-header"},Ul={class:"header-left"},Rl={class:"restaurant-meta"},Tl={class:"details-grid"},Pl={class:"detail-item"},Dl={class:"label"},Ml={class:"value"},Sl={class:"detail-item"},Fl={class:"label"},Ll={class:"value"},jl={class:"detail-item"},Ol={class:"value"},Bl={class:"detail-item"},Il={class:"value"},$l={class:"detail-item"},Al={class:"label"},Kl={class:"value"},Nl={class:"detail-item"},Hl={class:"label"},Jl={class:"value"},Ql={key:0,class:"location-section"},ql={class:"coordinates"},Gl={class:"coordinate-item"},Yl={class:"value"},Wl={class:"coordinate-item"},Xl={class:"value"},Zl={class:"map-container"},ea={key:1,class:"no-location"},la={class:"contact-section"},aa={key:0,class:"restaurant-link"},ta={key:1,class:"no-website"},sa={__name:"Explore",setup(oa){const v=we(),j=L(()=>v.restaurants),C=L(()=>v.loading),z=L(()=>v.pagination),w=f(""),D=f(!1),O=f("table"),U=f({regions:[],cities:[],cuisines:[],price_levels:[]}),q=f({}),u=f({stars:null,region:null,city:null,cuisine:null,price_level:null}),M=f(!1),i=f(null),G=f("basic"),B=f(null);let R=null;const Y=L(()=>u.value.region?q.value[u.value.region]||[]:U.value.cities),T=o=>({"€":"经济实惠","€€":"中等价位","€€€":"高档消费","€€€€":"奢华体验"})[o]||o,te=o=>({"€":"success","€€":"primary","€€€":"warning","€€€€":"danger"})[o]||"info",se=()=>{D.value=!D.value},oe=o=>{u.value.city=null},ne=async()=>{try{const o=await K.get("/api/filter-options");if(o.data.success){U.value=o.data.data;const e=await K.get("/api/restaurants?per_page=1000");if(e.data.success){const d={};e.data.data.restaurants.forEach(c=>{d[c.region]||(d[c.region]=[]),d[c.region].includes(c.city)||d[c.region].push(c.city)}),q.value=d}}}catch(o){console.error("获取筛选选项失败:",o)}},I=async()=>{try{v.setPage(1),v.clearFilters(),Object.keys(u.value).forEach(e=>{u.value[e]!==null&&u.value[e]!==""&&v.setFilter(e,u.value[e])});const o={};w.value&&w.value.trim()&&(o.q=w.value.trim()),await v.fetchRestaurants(o)}catch(o){console.error("搜索失败:",o),V.error("搜索失败: "+(o.message||"未知错误"))}},ie=async()=>{w.value="",u.value={stars:null,region:null,city:null,cuisine:null,price_level:null},v.clearFilters(),await v.fetchRestaurants()},re=()=>{try{const o=j.value.map(m=>({餐厅名称:m.name,星级:m.stars,城市:m.city,地区:m.region,菜系:m.cuisine,价格:T(m.price_level)||"未知",获奖年份:m.year})),e=[Object.keys(o[0]).join(","),...o.map(m=>Object.values(m).join(","))].join(`
`),d=new Blob([e],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");c.href=URL.createObjectURL(d),c.download=`米其林餐厅搜索结果-${new Date().toLocaleDateString()}.csv`,c.click(),V.success("导出成功！")}catch(o){console.error("导出失败:",o),V.error("导出失败")}},de=async o=>{try{v.pagination.per_page=o,v.setPage(1),await v.fetchRestaurants()}catch(e){console.error("修改页面大小失败:",e),V.error("修改页面大小失败")}},ue=async o=>{try{v.setPage(o),await v.fetchRestaurants()}catch(e){console.error("切换页面失败:",e),V.error("切换页面失败")}},S=o=>{i.value=o,M.value=!0,Ee(()=>{o.latitude&&o.longitude&&ce(o.latitude,o.longitude,o.name)})},ce=(o,e,d)=>{B.value&&(R&&R.remove(),R=Q.map(B.value).setView([o,e],15),Q.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(R),Q.marker([o,e]).addTo(R).bindPopup(`<b>${d}</b><br/>米其林星级餐厅`).openPopup())},_e=()=>{M.value=!1,i.value=null};return ke(async()=>{try{try{await K.get("/api/health")}catch{V.error("无法连接到后端服务，请检查服务是否启动");return}await ne(),await v.fetchRestaurants()}catch(o){console.error("页面初始化失败:",o)}}),(o,e)=>{var ee;const d=Ce,c=ze,m=Ue,pe=Re,g=$e,k=Te,P=Ae,ve=Pe,me=Ke,y=Ne,$=He,W=Je,fe=De,be=Me,A=Qe,X=qe,ge=Ge,ye=Ye,he=Se,Z=Fe;return n(),p("div",Xe,[t("div",Ze,[e[33]||(e[33]=t("div",{class:"page-header"},[t("h1",{class:"page-title"},"数据探索"),t("p",{class:"page-subtitle"},"交互式数据查询和探索工具")],-1)),t("div",el,[t("div",ll,[t("h3",al,[a(d,null,{default:s(()=>[a(b(H))]),_:1}),e[12]||(e[12]=r(" 高级搜索与筛选 "))]),a(c,{text:"",onClick:se},{default:s(()=>[r(_(D.value?"点此切换简单输入搜索":"点此切换多条件筛选"),1)]),_:1})]),t("div",tl,[t("div",sl,[a(m,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=l=>w.value=l),placeholder:"输入餐厅名称、城市、地区或菜系进行搜索...",size:"large",clearable:"",onKeyup:Ve(I,["enter"]),style:{"max-width":"500px"}},{prefix:s(()=>[a(d,null,{default:s(()=>[a(b(H))]),_:1})]),append:s(()=>[a(c,{type:"primary",onClick:I,loading:C.value},{default:s(()=>e[13]||(e[13]=[r(" 搜索 ")])),_:1,__:[13]},8,["loading"])]),_:1},8,["modelValue"])]),N(t("div",ol,[a(pe,{"content-position":"left"},{default:s(()=>e[14]||(e[14]=[r("高级筛选条件")])),_:1,__:[14]}),a(ve,{model:u.value,"label-width":"80px",class:"filter-form"},{default:s(()=>[t("div",nl,[a(P,{label:"星级",class:"filter-item"},{default:s(()=>[a(k,{modelValue:u.value.stars,"onUpdate:modelValue":e[1]||(e[1]=l=>u.value.stars=l),placeholder:"全部星级",clearable:""},{default:s(()=>[(n(),p(x,null,E(3,l=>a(g,{key:l,label:`${l}星`,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(P,{label:"地区",class:"filter-item"},{default:s(()=>[a(k,{modelValue:u.value.region,"onUpdate:modelValue":e[2]||(e[2]=l=>u.value.region=l),placeholder:"全部地区",clearable:"",filterable:"",onChange:oe},{default:s(()=>[(n(!0),p(x,null,E(U.value.regions,l=>(n(),h(g,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(P,{label:"城市",class:"filter-item"},{default:s(()=>[a(k,{modelValue:u.value.city,"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.city=l),placeholder:"全部城市",clearable:"",filterable:"",disabled:!Y.value.length},{default:s(()=>[(n(!0),p(x,null,E(Y.value,l=>(n(),h(g,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(P,{label:"菜系",class:"filter-item"},{default:s(()=>[a(k,{modelValue:u.value.cuisine,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.cuisine=l),placeholder:"全部菜系",clearable:"",filterable:""},{default:s(()=>[(n(!0),p(x,null,E(U.value.cuisines,l=>(n(),h(g,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(P,{label:"价格区间",class:"filter-item"},{default:s(()=>[a(k,{modelValue:u.value.price_level,"onUpdate:modelValue":e[5]||(e[5]=l=>u.value.price_level=l),placeholder:"全部价格",clearable:""},{default:s(()=>[(n(!0),p(x,null,E(U.value.price_levels,l=>(n(),h(g,{key:l,label:T(l),value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),t("div",il,[a(c,{type:"primary",onClick:I,loading:C.value},{default:s(()=>[a(d,null,{default:s(()=>[a(b(H))]),_:1}),e[15]||(e[15]=r(" 应用筛选 "))]),_:1,__:[15]},8,["loading"]),a(c,{onClick:ie},{default:s(()=>[a(d,null,{default:s(()=>[a(b(Le))]),_:1}),e[16]||(e[16]=r(" 重置筛选 "))]),_:1,__:[16]})])]),_:1},8,["model"])],512),[[xe,D.value]])])]),t("div",rl,[t("div",dl,[t("h3",ul,[a(d,null,{default:s(()=>[a(b(je))]),_:1}),e[17]||(e[17]=r(" 餐厅列表 "))]),t("div",cl,[a(k,{modelValue:O.value,"onUpdate:modelValue":e[6]||(e[6]=l=>O.value=l),style:{width:"120px","margin-right":"12px"}},{default:s(()=>[a(g,{label:"表格视图",value:"table"}),a(g,{label:"卡片视图",value:"card"})]),_:1},8,["modelValue"]),a(c,{onClick:re,type:"primary",plain:"",size:"small"},{default:s(()=>[a(d,null,{default:s(()=>[a(b(Oe))]),_:1}),e[18]||(e[18]=r(" 导出 "))]),_:1,__:[18]})])]),t("div",_l,[O.value==="table"?(n(),p("div",pl,[N((n(),h(fe,{data:j.value,stripe:"",style:{width:"100%"},"empty-text":C.value?"加载中...":"没有符合条件的餐厅","row-class-name":"restaurant-row",onRowClick:S},{default:s(()=>[a(y,{prop:"name",label:"餐厅名称","min-width":"200",fixed:"left"},{default:s(l=>[t("div",vl,[a(me,{class:"restaurant-name",onClick:le(F=>S(l.row),["stop"])},{default:s(()=>[r(_(l.row.name),1)]),_:2},1032,["onClick"])])]),_:1}),a(y,{prop:"stars",label:"星级",width:"100",align:"center",sortable:""},{default:s(l=>[t("div",ml,[a($,{"model-value":l.row.stars,disabled:"",max:3,"show-score":"","text-color":"#ff9900",size:"small"},null,8,["model-value"])])]),_:1}),a(y,{prop:"city",label:"城市",width:"140",sortable:""}),a(y,{prop:"region",label:"地区",width:"140",sortable:""}),a(y,{prop:"cuisine",label:"菜系","min-width":"120",sortable:""}),a(y,{prop:"price_level",label:"价格",width:"120",align:"center"},{default:s(l=>[l.row.price_level?(n(),h(W,{key:0,size:"small",type:te(l.row.price_level)},{default:s(()=>[r(_(T(l.row.price_level)),1)]),_:2},1032,["type"])):(n(),p("span",fl,"未知"))]),_:1}),a(y,{label:"操作",width:"80",fixed:"right"},{default:s(l=>[a(c,{type:"primary",size:"small",onClick:le(F=>S(l.row),["stop"])},{default:s(()=>e[19]||(e[19]=[r(" 详情 ")])),_:2,__:[19]},1032,["onClick"])]),_:1})]),_:1},8,["data","empty-text"])),[[Z,C.value]])])):(n(),p("div",bl,[N((n(),p("div",gl,[(n(!0),p(x,null,E(j.value,l=>(n(),p("div",{key:l.name,class:"restaurant-card",onClick:F=>S(l)},[t("div",hl,[t("h4",wl,_(l.name),1),a($,{modelValue:l.stars,"onUpdate:modelValue":F=>l.stars=F,disabled:"",max:3,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",kl,[t("p",null,[e[20]||(e[20]=t("strong",null,"位置：",-1)),r(_(l.city)+", "+_(l.region),1)]),t("p",null,[e[21]||(e[21]=t("strong",null,"菜系：",-1)),r(_(l.cuisine),1)]),l.price_level?(n(),p("p",Vl,[e[22]||(e[22]=t("strong",null,"价格：",-1)),r(_(T(l.price_level)),1)])):J("",!0)]),t("div",xl,[a(c,{size:"small",type:"primary"},{default:s(()=>e[23]||(e[23]=[r("查看详情")])),_:1,__:[23]})])],8,yl))),128))])),[[Z,C.value]])])),t("div",El,[a(be,{"current-page":z.value.page,"onUpdate:currentPage":e[7]||(e[7]=l=>z.value.page=l),"page-size":z.value.per_page,"onUpdate:pageSize":e[8]||(e[8]=l=>z.value.per_page=l),"page-sizes":[10,20,50,100],total:z.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:ue,background:""},null,8,["current-page","page-size","total"])])])]),a(he,{modelValue:M.value,"onUpdate:modelValue":e[11]||(e[11]=l=>M.value=l),title:((ee=i.value)==null?void 0:ee.name)||"餐厅详情",width:"900px","before-close":_e,class:"restaurant-details-dialog"},{default:s(()=>[i.value?(n(),p("div",Cl,[t("div",zl,[t("div",Ul,[t("h2",null,_(i.value.name),1),t("div",Rl,[a($,{modelValue:i.value.stars,"onUpdate:modelValue":e[9]||(e[9]=l=>i.value.stars=l),disabled:"",max:3,"show-score":""},null,8,["modelValue"]),i.value.year?(n(),h(W,{key:0,type:"primary",style:{"margin-left":"12px"}},{default:s(()=>[r(_(i.value.year)+"年获得 ",1)]),_:1})):J("",!0)])])]),a(ye,{modelValue:G.value,"onUpdate:modelValue":e[10]||(e[10]=l=>G.value=l),type:"border-card"},{default:s(()=>[a(A,{label:"基本信息",name:"basic"},{default:s(()=>[t("div",Tl,[t("div",Pl,[t("span",Dl,[a(d,null,{default:s(()=>[a(b(ae))]),_:1}),e[24]||(e[24]=r(" 城市 "))]),t("span",Ml,_(i.value.city),1)]),t("div",Sl,[t("span",Fl,[a(d,null,{default:s(()=>[a(b(Be))]),_:1}),e[25]||(e[25]=r(" 地区 "))]),t("span",Ll,_(i.value.region),1)]),t("div",jl,[e[26]||(e[26]=t("span",{class:"label"}," 菜系 ",-1)),t("span",Ol,_(i.value.cuisine),1)]),t("div",Bl,[e[27]||(e[27]=t("span",{class:"label"}," 价格 ",-1)),t("span",Il,_(T(i.value.price_level)||"未知"),1)]),t("div",$l,[t("span",Al,[a(d,null,{default:s(()=>[a(b(Ie))]),_:1}),e[28]||(e[28]=r(" 获奖年份 "))]),t("span",Kl,_(i.value.year),1)]),t("div",Nl,[t("span",Hl,[a(d,null,{default:s(()=>[a(b(ae))]),_:1}),e[29]||(e[29]=r(" 大陆 "))]),t("span",Jl,_(i.value.continent||"未知"),1)])])]),_:1}),a(A,{label:"位置信息",name:"location"},{default:s(()=>[i.value.latitude&&i.value.longitude?(n(),p("div",Ql,[t("div",ql,[t("div",Gl,[e[30]||(e[30]=t("span",{class:"label"},"纬度:",-1)),t("span",Yl,_(i.value.latitude.toFixed(6)),1)]),t("div",Wl,[e[31]||(e[31]=t("span",{class:"label"},"经度:",-1)),t("span",Xl,_(i.value.longitude.toFixed(6)),1)])]),t("div",Zl,[t("div",{ref_key:"mapRef",ref:B,class:"leaflet-map"},null,512)])])):(n(),p("div",ea,[a(X,{description:"暂无位置信息"})]))]),_:1}),a(A,{label:"联系方式",name:"contact"},{default:s(()=>[t("div",la,[i.value.url?(n(),p("div",aa,[e[32]||(e[32]=t("h4",null,"官方网站",-1)),a(ge,{href:i.value.url,target:"_blank",type:"primary"},{default:s(()=>[r(_(i.value.url),1)]),_:1},8,["href"])])):(n(),p("div",ta,[a(X,{description:"暂无官方网站信息"})]))])]),_:1})]),_:1},8,["modelValue"])])):J("",!0)]),_:1},8,["modelValue","title"])])])}}},va=We(sa,[["__scopeId","data-v-c7819e2b"]]);export{va as default};
