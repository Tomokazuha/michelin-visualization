import{a as xe,b as K}from"./index-88317f61.js";/* empty css                   *//* empty css                    *//* empty css                 *//* empty css                        *//* empty css                *//* empty css                     *//* empty css                  */import{l as O,r as f,M as Ve,L as V,y as n,z as p,A as t,B as l,C as s,u as g,a7 as d,Z as _,aA as Ee,P as q,aB as Ce,ad as E,ae as C,O as h,aC as te,Q as H,n as ze,I as Re,ac as Ue,aw as Me,aD as Pe,ar as Se,am as Te,al as De,aE as Fe,aF as Le,an as Oe,aG as je,ao as Be,av as Ie,au as $e,ap as Ne,aH as Ae,aI as Ke,aJ as qe,aK as He,aL as Qe,az as Ge,S as Je,H as Q,aq as Ze,aM as We,aN as Xe,F as se,aO as Ye,aP as el}from"./element-plus-f32ef508.js";import"./echarts-37646912.js";import{_ as ll,L as G}from"./leaflet-5945a372.js";const al={class:"explore-view"},tl={class:"explore-container"},sl={class:"card"},ol={class:"card-header"},nl={class:"card-title"},il={class:"card-body"},dl={class:"search-section"},rl={class:"advanced-filters"},ul={class:"filter-actions"},cl={class:"card"},_l={class:"card-header"},pl={class:"card-title"},vl={class:"table-controls"},ml={class:"card-body"},fl={key:0},gl={class:"restaurant-name-cell"},bl={class:"stars-display"},yl={key:1,class:"text-gray"},hl={key:1,class:"restaurant-cards"},wl={class:"cards-grid"},kl=["onClick"],xl={class:"card-header"},Vl={class:"card-title"},El={class:"card-content"},Cl={key:0},zl={class:"card-actions"},Rl={class:"pagination-container"},Ul={key:0,class:"restaurant-details"},Ml={class:"restaurant-header"},Pl={class:"header-left"},Sl={class:"restaurant-meta"},Tl={class:"details-grid"},Dl={class:"detail-item"},Fl={class:"label"},Ll={class:"value"},Ol={class:"detail-item"},jl={class:"label"},Bl={class:"value"},Il={class:"detail-item"},$l={class:"value"},Nl={class:"detail-item"},Al={class:"value"},Kl={class:"detail-item"},ql={class:"label"},Hl={class:"value"},Ql={class:"detail-item"},Gl={class:"label"},Jl={class:"value"},Zl={key:0,class:"location-section"},Wl={class:"coordinates"},Xl={class:"coordinate-item"},Yl={class:"value"},ea={class:"coordinate-item"},la={class:"value"},aa={class:"map-container"},ta={key:1,class:"no-location"},sa={class:"contact-section"},oa={key:0,class:"restaurant-link"},na={key:1,class:"no-website"},ia={__name:"Explore",setup(da){const v=xe(),j=O(()=>v.restaurants),z=O(()=>v.loading),R=O(()=>v.pagination),w=f(""),T=f(!1),B=f("table"),U=f({regions:[],cities:[],cuisines:[],price_levels:[]}),J=f({}),u=f({stars:null,region:null,city:null,cuisine:null,price_level:null}),D=f(!1),i=f(null),Z=f("basic"),I=f(null);let M=null;const W=O(()=>u.value.region?J.value[u.value.region]||[]:U.value.cities),P=o=>({"€":"经济实惠","€€":"中等价位","€€€":"高档消费","€€€€":"奢华体验"})[o]||o,oe=o=>({"€":"success","€€":"primary","€€€":"warning","€€€€":"danger"})[o]||"info",ne=()=>{T.value=!T.value},ie=o=>{u.value.city=null},de=async()=>{try{const o=await K.get("/api/filter-options");if(o.data.success){U.value=o.data.data;const e=await K.get("/api/restaurants?per_page=1000");if(e.data.success){const r={};e.data.data.restaurants.forEach(c=>{r[c.region]||(r[c.region]=[]),r[c.region].includes(c.city)||r[c.region].push(c.city)}),J.value=r}}}catch(o){console.error("获取筛选选项失败:",o)}},$=async()=>{try{v.setPage(1),v.clearFilters(),Object.keys(u.value).forEach(e=>{u.value[e]!==null&&u.value[e]!==""&&v.setFilter(e,u.value[e])});const o={};w.value&&w.value.trim()&&(o.q=w.value.trim()),await v.fetchRestaurants(o)}catch(o){console.error("搜索失败:",o),V.error("搜索失败: "+(o.message||"未知错误"))}},re=async()=>{w.value="",u.value={stars:null,region:null,city:null,cuisine:null,price_level:null},v.clearFilters(),await v.fetchRestaurants()},ue=()=>{try{const o=j.value.map(m=>({餐厅名称:m.name,星级:m.stars,城市:m.city,地区:m.region,菜系:m.cuisine,价格:P(m.price_level)||"未知",获奖年份:m.year})),e=[Object.keys(o[0]).join(","),...o.map(m=>Object.values(m).join(","))].join(`
`),r=new Blob([e],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");c.href=URL.createObjectURL(r),c.download=`米其林餐厅搜索结果-${new Date().toLocaleDateString()}.csv`,c.click(),V.success("导出成功！")}catch(o){console.error("导出失败:",o),V.error("导出失败")}},ce=async o=>{try{v.pagination.per_page=o,v.setPage(1),await v.fetchRestaurants()}catch(e){console.error("修改页面大小失败:",e),V.error("修改页面大小失败")}},_e=async o=>{try{v.setPage(o),await v.fetchRestaurants()}catch(e){console.error("切换页面失败:",e),V.error("切换页面失败")}},F=o=>{i.value=o,D.value=!0,ze(()=>{o.latitude&&o.longitude&&pe(o.latitude,o.longitude,o.name)})},pe=(o,e,r)=>{I.value&&(M&&M.remove(),M=G.map(I.value).setView([o,e],15),G.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(M),G.marker([o,e]).addTo(M).bindPopup(`<b>${r}</b><br/>米其林星级餐厅`).openPopup())},ve=()=>{D.value=!1,i.value=null};return Ve(async()=>{try{try{await K.get("/api/health")}catch{V.error("无法连接到后端服务，请检查服务是否启动");return}await de(),await v.fetchRestaurants()}catch(o){console.error("页面初始化失败:",o)}}),(o,e)=>{var ae;const r=Re,c=Ue,m=Me,me=Pe,b=Se,k=Te,S=De,x=Fe,X=Le,fe=Oe,ge=je,y=Be,N=Ie,Y=$e,be=Ne,ye=Ae,A=Ke,ee=qe,he=He,we=Qe,ke=Ge,le=Je;return n(),p("div",al,[t("div",tl,[e[33]||(e[33]=t("div",{class:"page-header"},[t("h1",{class:"page-title"},"数据探索"),t("p",{class:"page-subtitle"},"交互式数据查询和探索工具")],-1)),t("div",sl,[t("div",ol,[t("h3",nl,[l(r,null,{default:s(()=>[l(g(Q))]),_:1}),e[12]||(e[12]=d(" 高级搜索与筛选 "))]),l(c,{text:"",onClick:ne},{default:s(()=>[d(_(T.value?"点此切换简单输入搜索":"点此切换多条件筛选"),1)]),_:1})]),t("div",il,[t("div",dl,[l(m,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=a=>w.value=a),placeholder:"输入餐厅名称、城市、地区或菜系进行搜索...",size:"large",clearable:"",onKeyup:Ee($,["enter"]),style:{"max-width":"500px"}},{prefix:s(()=>[l(r,null,{default:s(()=>[l(g(Q))]),_:1})]),append:s(()=>[l(c,{type:"primary",onClick:$,loading:z.value},{default:s(()=>e[13]||(e[13]=[d(" 搜索 ")])),_:1,__:[13]},8,["loading"])]),_:1},8,["modelValue"])]),q(t("div",rl,[l(me,{"content-position":"left"},{default:s(()=>e[14]||(e[14]=[d("高级筛选条件")])),_:1,__:[14]}),l(fe,{model:u.value,"label-width":"80px"},{default:s(()=>[l(X,{gutter:20},{default:s(()=>[l(x,{span:6},{default:s(()=>[l(S,{label:"星级"},{default:s(()=>[l(k,{modelValue:u.value.stars,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.stars=a),placeholder:"全部星级",clearable:""},{default:s(()=>[(n(),p(E,null,C(3,a=>l(b,{key:a,label:`${a}星`,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(x,{span:6},{default:s(()=>[l(S,{label:"地区"},{default:s(()=>[l(k,{modelValue:u.value.region,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.region=a),placeholder:"全部地区",clearable:"",filterable:"",onChange:ie},{default:s(()=>[(n(!0),p(E,null,C(U.value.regions,a=>(n(),h(b,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(x,{span:6},{default:s(()=>[l(S,{label:"城市"},{default:s(()=>[l(k,{modelValue:u.value.city,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.city=a),placeholder:"全部城市",clearable:"",filterable:"",disabled:!W.value.length},{default:s(()=>[(n(!0),p(E,null,C(W.value,a=>(n(),h(b,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(x,{span:6},{default:s(()=>[l(S,{label:"菜系"},{default:s(()=>[l(k,{modelValue:u.value.cuisine,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.cuisine=a),placeholder:"全部菜系",clearable:"",filterable:""},{default:s(()=>[(n(!0),p(E,null,C(U.value.cuisines,a=>(n(),h(b,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(X,{gutter:20,style:{"margin-top":"16px"}},{default:s(()=>[l(x,{span:6},{default:s(()=>[l(S,{label:"价格区间"},{default:s(()=>[l(k,{modelValue:u.value.price_level,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.price_level=a),placeholder:"全部价格",clearable:""},{default:s(()=>[(n(!0),p(E,null,C(U.value.price_levels,a=>(n(),h(b,{key:a,label:P(a),value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(x,{span:18},{default:s(()=>[t("div",ul,[l(c,{type:"primary",onClick:$,loading:z.value},{default:s(()=>[l(r,null,{default:s(()=>[l(g(Q))]),_:1}),e[15]||(e[15]=d(" 应用筛选 "))]),_:1,__:[15]},8,["loading"]),l(c,{onClick:re},{default:s(()=>[l(r,null,{default:s(()=>[l(g(Ze))]),_:1}),e[16]||(e[16]=d(" 重置筛选 "))]),_:1,__:[16]})])]),_:1})]),_:1})]),_:1},8,["model"])],512),[[Ce,T.value]])])]),t("div",cl,[t("div",_l,[t("h3",pl,[l(r,null,{default:s(()=>[l(g(We))]),_:1}),e[17]||(e[17]=d(" 餐厅列表 "))]),t("div",vl,[l(k,{modelValue:B.value,"onUpdate:modelValue":e[6]||(e[6]=a=>B.value=a),style:{width:"120px","margin-right":"12px"}},{default:s(()=>[l(b,{label:"表格视图",value:"table"}),l(b,{label:"卡片视图",value:"card"})]),_:1},8,["modelValue"]),l(c,{onClick:ue,type:"primary",plain:"",size:"small"},{default:s(()=>[l(r,null,{default:s(()=>[l(g(Xe))]),_:1}),e[18]||(e[18]=d(" 导出 "))]),_:1,__:[18]})])]),t("div",ml,[B.value==="table"?(n(),p("div",fl,[q((n(),h(be,{data:j.value,stripe:"",style:{width:"100%"},"empty-text":z.value?"加载中...":"没有符合条件的餐厅","row-class-name":"restaurant-row",onRowClick:F},{default:s(()=>[l(y,{prop:"name",label:"餐厅名称","min-width":"200",fixed:"left"},{default:s(a=>[t("div",gl,[l(ge,{class:"restaurant-name",onClick:te(L=>F(a.row),["stop"])},{default:s(()=>[d(_(a.row.name),1)]),_:2},1032,["onClick"])])]),_:1}),l(y,{prop:"stars",label:"星级",width:"100",align:"center",sortable:""},{default:s(a=>[t("div",bl,[l(N,{"model-value":a.row.stars,disabled:"",max:3,"show-score":"","text-color":"#ff9900",size:"small"},null,8,["model-value"])])]),_:1}),l(y,{prop:"city",label:"城市",width:"140",sortable:""}),l(y,{prop:"region",label:"地区",width:"140",sortable:""}),l(y,{prop:"cuisine",label:"菜系","min-width":"120",sortable:""}),l(y,{prop:"price_level",label:"价格",width:"120",align:"center"},{default:s(a=>[a.row.price_level?(n(),h(Y,{key:0,size:"small",type:oe(a.row.price_level)},{default:s(()=>[d(_(P(a.row.price_level)),1)]),_:2},1032,["type"])):(n(),p("span",yl,"未知"))]),_:1}),l(y,{label:"操作",width:"100",fixed:"right"},{default:s(a=>[l(c,{type:"primary",size:"small",onClick:te(L=>F(a.row),["stop"])},{default:s(()=>e[19]||(e[19]=[d(" 详情 ")])),_:2,__:[19]},1032,["onClick"])]),_:1})]),_:1},8,["data","empty-text"])),[[le,z.value]])])):(n(),p("div",hl,[q((n(),p("div",wl,[(n(!0),p(E,null,C(j.value,a=>(n(),p("div",{key:a.name,class:"restaurant-card",onClick:L=>F(a)},[t("div",xl,[t("h4",Vl,_(a.name),1),l(N,{modelValue:a.stars,"onUpdate:modelValue":L=>a.stars=L,disabled:"",max:3,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",El,[t("p",null,[e[20]||(e[20]=t("strong",null,"位置：",-1)),d(_(a.city)+", "+_(a.region),1)]),t("p",null,[e[21]||(e[21]=t("strong",null,"菜系：",-1)),d(_(a.cuisine),1)]),a.price_level?(n(),p("p",Cl,[e[22]||(e[22]=t("strong",null,"价格：",-1)),d(_(P(a.price_level)),1)])):H("",!0)]),t("div",zl,[l(c,{size:"small",type:"primary"},{default:s(()=>e[23]||(e[23]=[d("查看详情")])),_:1,__:[23]})])],8,kl))),128))])),[[le,z.value]])])),t("div",Rl,[l(ye,{"current-page":R.value.page,"onUpdate:currentPage":e[7]||(e[7]=a=>R.value.page=a),"page-size":R.value.per_page,"onUpdate:pageSize":e[8]||(e[8]=a=>R.value.per_page=a),"page-sizes":[10,20,50,100],total:R.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ce,onCurrentChange:_e,background:""},null,8,["current-page","page-size","total"])])])]),l(ke,{modelValue:D.value,"onUpdate:modelValue":e[11]||(e[11]=a=>D.value=a),title:((ae=i.value)==null?void 0:ae.name)||"餐厅详情",width:"900px","before-close":ve,class:"restaurant-details-dialog"},{default:s(()=>[i.value?(n(),p("div",Ul,[t("div",Ml,[t("div",Pl,[t("h2",null,_(i.value.name),1),t("div",Sl,[l(N,{modelValue:i.value.stars,"onUpdate:modelValue":e[9]||(e[9]=a=>i.value.stars=a),disabled:"",max:3,"show-score":""},null,8,["modelValue"]),i.value.year?(n(),h(Y,{key:0,type:"primary",style:{"margin-left":"12px"}},{default:s(()=>[d(_(i.value.year)+"年获得 ",1)]),_:1})):H("",!0)])])]),l(we,{modelValue:Z.value,"onUpdate:modelValue":e[10]||(e[10]=a=>Z.value=a),type:"border-card"},{default:s(()=>[l(A,{label:"基本信息",name:"basic"},{default:s(()=>[t("div",Tl,[t("div",Dl,[t("span",Fl,[l(r,null,{default:s(()=>[l(g(se))]),_:1}),e[24]||(e[24]=d(" 城市 "))]),t("span",Ll,_(i.value.city),1)]),t("div",Ol,[t("span",jl,[l(r,null,{default:s(()=>[l(g(Ye))]),_:1}),e[25]||(e[25]=d(" 地区 "))]),t("span",Bl,_(i.value.region),1)]),t("div",Il,[e[26]||(e[26]=t("span",{class:"label"}," 菜系 ",-1)),t("span",$l,_(i.value.cuisine),1)]),t("div",Nl,[e[27]||(e[27]=t("span",{class:"label"}," 价格 ",-1)),t("span",Al,_(P(i.value.price_level)||"未知"),1)]),t("div",Kl,[t("span",ql,[l(r,null,{default:s(()=>[l(g(el))]),_:1}),e[28]||(e[28]=d(" 获奖年份 "))]),t("span",Hl,_(i.value.year),1)]),t("div",Ql,[t("span",Gl,[l(r,null,{default:s(()=>[l(g(se))]),_:1}),e[29]||(e[29]=d(" 大陆 "))]),t("span",Jl,_(i.value.continent||"未知"),1)])])]),_:1}),l(A,{label:"位置信息",name:"location"},{default:s(()=>[i.value.latitude&&i.value.longitude?(n(),p("div",Zl,[t("div",Wl,[t("div",Xl,[e[30]||(e[30]=t("span",{class:"label"},"纬度:",-1)),t("span",Yl,_(i.value.latitude.toFixed(6)),1)]),t("div",ea,[e[31]||(e[31]=t("span",{class:"label"},"经度:",-1)),t("span",la,_(i.value.longitude.toFixed(6)),1)])]),t("div",aa,[t("div",{ref_key:"mapRef",ref:I,class:"leaflet-map"},null,512)])])):(n(),p("div",ta,[l(ee,{description:"暂无位置信息"})]))]),_:1}),l(A,{label:"联系方式",name:"contact"},{default:s(()=>[t("div",sa,[i.value.url?(n(),p("div",oa,[e[32]||(e[32]=t("h4",null,"官方网站",-1)),l(he,{href:i.value.url,target:"_blank",type:"primary"},{default:s(()=>[d(_(i.value.url),1)]),_:1},8,["href"])])):(n(),p("div",na,[l(ee,{description:"暂无官方网站信息"})]))])]),_:1})]),_:1},8,["modelValue"])])):H("",!0)]),_:1},8,["modelValue","title"])])])}}},ha=ll(ia,[["__scopeId","data-v-5dcc1bb4"]]);export{ha as default};
