import{a as ot}from"./index-88317f61.js";/* empty css                        *//* empty css                 *//* empty css                    *//* empty css                     *//* empty css                  *//* empty css                        */import{c as rt,r as B,l as D,w as Q,M as $,N as at,y as z,z as N,A as p,B as x,C as P,a7 as R,Q as V,Z as E,P as lt,n as ut,ag as ht,ah as dt,ai as _t,S as ct,ad as X,ae as Y,O as ft,u as pt,L as mt,aj as gt,ak as vt,al as Lt,am as yt,I as Ct,ac as Mt,an as kt,ao as bt,$ as wt,ap as xt,aq as St,ar as Ot}from"./element-plus-f32ef508.js";import{_ as tt,L as I,i as Pt,s as Bt}from"./leaflet-5945a372.js";import"./echarts-37646912.js";(function(){function d(_){return this instanceof d?(this._canvas=_=typeof _=="string"?document.getElementById(_):_,this._ctx=_.getContext("2d"),this._width=_.width,this._height=_.height,this._max=1,void this.clear()):new d(_)}d.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(_,f){return this._data=_,this},max:function(_){return this._max=_,this},add:function(_){return this._data.push(_),this},clear:function(){return this._data=[],this},radius:function(_,f){f=f||15;var m=this._circle=document.createElement("canvas"),C=m.getContext("2d"),t=this._r=_+f;return m.width=m.height=2*t,C.shadowOffsetX=C.shadowOffsetY=200,C.shadowBlur=f,C.shadowColor="black",C.beginPath(),C.arc(t-200,t-200,_,0,2*Math.PI,!0),C.closePath(),C.fill(),this},gradient:function(_){var f=document.createElement("canvas"),m=f.getContext("2d"),C=m.createLinearGradient(0,0,0,256);f.width=1,f.height=256;for(var t in _)C.addColorStop(t,_[t]);return m.fillStyle=C,m.fillRect(0,0,1,256),this._grad=m.getImageData(0,0,1,256).data,this},draw:function(_){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var f=this._ctx;f.clearRect(0,0,this._width,this._height);for(var m,C=0,t=this._data.length;t>C;C++)m=this._data[C],f.globalAlpha=Math.max(m[2]/this._max,_||.05),f.drawImage(this._circle,m[0]-this._r,m[1]-this._r);var e=f.getImageData(0,0,this._width,this._height);return this._colorize(e.data,this._grad),f.putImageData(e,0,0),this},_colorize:function(_,f){for(var m,C=3,t=_.length;t>C;C+=4)m=4*_[C],m&&(_[C-3]=f[m],_[C-2]=f[m+1],_[C-1]=f[m+2])}},window.simpleheat=d})(),L.HeatLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(d,_){this._latlngs=d,L.setOptions(this,_)},setLatLngs:function(d){return this._latlngs=d,this.redraw()},addLatLng:function(d){return this._latlngs.push(d),this.redraw()},setOptions:function(d){return L.setOptions(this,d),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return!this._heat||this._frame||this._map._animating||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(d){this._map=d,this._canvas||this._initCanvas(),d._panes.overlayPane.appendChild(this._canvas),d.on("moveend",this._reset,this),d.options.zoomAnimation&&L.Browser.any3d&&d.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(d){d.getPanes().overlayPane.removeChild(this._canvas),d.off("moveend",this._reset,this),d.options.zoomAnimation&&d.off("zoomanim",this._animateZoom,this)},addTo:function(d){return d.addLayer(this),this},_initCanvas:function(){var d=this._canvas=L.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),_=L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);d.style[_]="50% 50%";var f=this._map.getSize();d.width=f.x,d.height=f.y;var m=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(d,"leaflet-zoom-"+(m?"animated":"hide")),this._heat=simpleheat(d),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var d=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,d);var _=this._map.getSize();this._heat._width!==_.x&&(this._canvas.width=this._heat._width=_.x),this._heat._height!==_.y&&(this._canvas.height=this._heat._height=_.y),this._redraw()},_redraw:function(){var d,_,f,m,C,t,e,i,s,n=[],r=this._heat._r,o=this._map.getSize(),l=new L.Bounds(L.point([-r,-r]),o.add([r,r])),a=this.options.max===void 0?1:this.options.max,u=this.options.maxZoom===void 0?this._map.getMaxZoom():this.options.maxZoom,h=1/Math.pow(2,Math.max(0,Math.min(u-this._map.getZoom(),12))),k=r/2,c=[],g=this._map._getMapPanePos(),v=g.x%k,M=g.y%k;for(d=0,_=this._latlngs.length;_>d;d++)if(f=this._map.latLngToContainerPoint(this._latlngs[d]),l.contains(f)){C=Math.floor((f.x-v)/k)+2,t=Math.floor((f.y-M)/k)+2;var b=this._latlngs[d].alt!==void 0?this._latlngs[d].alt:this._latlngs[d][2]!==void 0?+this._latlngs[d][2]:1;s=b*h,c[t]=c[t]||[],m=c[t][C],m?(m[0]=(m[0]*m[2]+f.x*s)/(m[2]+s),m[1]=(m[1]*m[2]+f.y*s)/(m[2]+s),m[2]+=s):c[t][C]=[f.x,f.y,s]}for(d=0,_=c.length;_>d;d++)if(c[d])for(e=0,i=c[d].length;i>e;e++)m=c[d][e],m&&n.push([Math.round(m[0]),Math.round(m[1]),Math.min(m[2],a)]);this._heat.data(n).draw(this.options.minOpacity),this._frame=null},_animateZoom:function(d){var _=this._map.getZoomScale(d.zoom),f=this._map._getCenterOffset(d.center)._multiplyBy(-_).subtract(this._map._getMapPanePos());L.DomUtil.setTransform?L.DomUtil.setTransform(this._canvas,f,_):this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(f)+" scale("+_+")"}}),L.heatLayer=function(d,_){return new L.HeatLayer(d,_)};var W={exports:{}};(function(d,_){(function(f,m){m(_)})(rt,function(f){var m=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var e=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,e?this._withAnimation:this._noAnimation),this._markerCluster=e?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(t){if(t instanceof L.LayerGroup)return this.addLayers([t]);if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this.fire("layeradd",{layer:t}),this;if(!this._map)return this._needsClustering.push(t),this.fire("layeradd",{layer:t}),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom),this.fire("layeradd",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var e=t,i=this._zoom;if(t.__parent)for(;e.__parent._zoom>=i;)e=e.__parent;return this._currentShownBounds.contains(e.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,e):this._animationAddLayerNonAnimated(t,e)),this},removeLayer:function(t){return t instanceof L.LayerGroup?this.removeLayers([t]):t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this.fire("layerremove",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),t.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push({layer:t,latlng:t._latlng}),this.fire("layerremove",{layer:t}),this):(this._nonPointGroup.removeLayer(t),this.fire("layerremove",{layer:t}),this)},addLayers:function(t,e){if(!L.Util.isArray(t))return this.addLayer(t);var i=this._featureGroup,s=this._nonPointGroup,n=this.options.chunkedLoading,r=this.options.chunkInterval,o=this.options.chunkProgress,l=t.length,a=0,u=!0,h;if(this._map){var k=new Date().getTime(),c=L.bind(function(){var v=new Date().getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();a<l;a++){if(n&&a%200===0){var M=new Date().getTime()-v;if(M>r)break}if(h=t[a],h instanceof L.LayerGroup){u&&(t=t.slice(),u=!1),this._extractNonGroupLayers(h,t),l=t.length;continue}if(!h.getLatLng){s.addLayer(h),e||this.fire("layeradd",{layer:h});continue}if(!this.hasLayer(h)&&(this._addLayer(h,this._maxZoom),e||this.fire("layeradd",{layer:h}),h.__parent&&h.__parent.getChildCount()===2)){var b=h.__parent.getAllChildMarkers(),A=b[0]===h?b[1]:b[0];i.removeLayer(A)}}o&&o(a,l,new Date().getTime()-k),a===l?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(c,this.options.chunkDelay)},this);c()}else for(var g=this._needsClustering;a<l;a++){if(h=t[a],h instanceof L.LayerGroup){u&&(t=t.slice(),u=!1),this._extractNonGroupLayers(h,t),l=t.length;continue}if(!h.getLatLng){s.addLayer(h);continue}this.hasLayer(h)||g.push(h)}return this},removeLayers:function(t){var e,i,s=t.length,n=this._featureGroup,r=this._nonPointGroup,o=!0;if(!this._map){for(e=0;e<s;e++){if(i=t[e],i instanceof L.LayerGroup){o&&(t=t.slice(),o=!1),this._extractNonGroupLayers(i,t),s=t.length;continue}this._arraySplice(this._needsClustering,i),r.removeLayer(i),this.hasLayer(i)&&this._needsRemoving.push({layer:i,latlng:i._latlng}),this.fire("layerremove",{layer:i})}return this}if(this._unspiderfy){this._unspiderfy();var l=t.slice(),a=s;for(e=0;e<a;e++){if(i=l[e],i instanceof L.LayerGroup){this._extractNonGroupLayers(i,l),a=l.length;continue}this._unspiderfyLayer(i)}}for(e=0;e<s;e++){if(i=t[e],i instanceof L.LayerGroup){o&&(t=t.slice(),o=!1),this._extractNonGroupLayers(i,t),s=t.length;continue}if(!i.__parent){r.removeLayer(i),this.fire("layerremove",{layer:i});continue}this._removeLayer(i,!0,!0),this.fire("layerremove",{layer:i}),n.hasLayer(i)&&(n.removeLayer(i),i.clusterShow&&i.clusterShow())}return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){t.off(this._childMarkerEventHandlers,this),delete t.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;this._topClusterLevel&&t.extend(this._topClusterLevel._bounds);for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var i=this._needsClustering.slice(),s=this._needsRemoving,n,r,o;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(i),r=i.length-1;r>=0;r--){for(n=!0,o=s.length-1;o>=0;o--)if(s[o].layer===i[r]){n=!1;break}n&&t.call(e,i[r])}this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},getLayer:function(t){var e=null;return t=parseInt(t,10),this.eachLayer(function(i){L.stamp(i)===t&&(e=i)}),e},hasLayer:function(t){if(!t)return!1;var e,i=this._needsClustering;for(e=i.length-1;e>=0;e--)if(i[e]===t)return!0;for(i=this._needsRemoving,e=i.length-1;e>=0;e--)if(i[e].layer===t)return!1;return!!(t.__parent&&t.__parent._group===this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){var i=this._map;typeof e!="function"&&(e=function(){});var s=function(){(i.hasLayer(t)||i.hasLayer(t.__parent))&&!this._inZoomAnimation&&(this._map.off("moveend",s,this),this.off("animationend",s,this),i.hasLayer(t)?e():t.__parent._icon&&(this.once("spiderfied",e,this),t.__parent.spiderfy()))};t._icon&&this._map.getBounds().contains(t.getLatLng())?e():t.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",s,this),this._map.panTo(t.getLatLng())):(this._map.on("moveend",s,this),this.on("animationend",s,this),t.__parent.zoomToBounds())},onAdd:function(t){this._map=t;var e,i,s;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(t),this._nonPointGroup.addTo(t),this._gridClusters||this._generateInitialClusters(),this._maxLat=t.options.crs.projection.MAX_LATITUDE,e=0,i=this._needsRemoving.length;e<i;e++)s=this._needsRemoving[e],s.newlatlng=s.layer._latlng,s.layer._latlng=s.latlng;for(e=0,i=this._needsRemoving.length;e<i;e++)s=this._needsRemoving[e],this._removeLayer(s.layer,!0),s.layer._latlng=s.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),i=this._needsClustering,this._needsClustering=[],this.addLayers(i,!0)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var i=t.length-1;i>=0;i--)if(t[i]===e)return t.splice(i,1),!0},_removeFromGridUnclustered:function(t,e){for(var i=this._map,s=this._gridUnclustered,n=Math.floor(this._map.getMinZoom());e>=n&&s[e].removeObject(t,i.project(t.getLatLng(),e));e--);},_childMarkerDragStart:function(t){t.target.__dragStart=t.target._latlng},_childMarkerMoved:function(t){if(!this._ignoreMove&&!t.target.__dragStart){var e=t.target._popup&&t.target._popup.isOpen();this._moveChild(t.target,t.oldLatLng,t.latlng),e&&t.target.openPopup()}},_moveChild:function(t,e,i){t._latlng=e,this.removeLayer(t),t._latlng=i,this.addLayer(t)},_childMarkerDragEnd:function(t){var e=t.target.__dragStart;delete t.target.__dragStart,e&&this._moveChild(t.target,e,t.target._latlng)},_removeLayer:function(t,e,i){var s=this._gridClusters,n=this._gridUnclustered,r=this._featureGroup,o=this._map,l=Math.floor(this._map.getMinZoom());e&&this._removeFromGridUnclustered(t,this._maxZoom);var a=t.__parent,u=a._markers,h;for(this._arraySplice(u,t);a&&(a._childCount--,a._boundsNeedUpdate=!0,!(a._zoom<l));)e&&a._childCount<=1?(h=a._markers[0]===t?a._markers[1]:a._markers[0],s[a._zoom].removeObject(a,o.project(a._cLatLng,a._zoom)),n[a._zoom].addObject(h,o.project(h.getLatLng(),a._zoom)),this._arraySplice(a.__parent._childClusters,a),a.__parent._markers.push(h),h.__parent=a.__parent,a._icon&&(r.removeLayer(a),i||r.addLayer(h))):a._iconNeedsUpdate=!0,a=a.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},fire:function(t,e,i){if(e&&e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;t="cluster"+t}L.FeatureGroup.prototype.fire.call(this,t,e,i)},listens:function(t,e){return L.FeatureGroup.prototype.listens.call(this,t,e)||L.FeatureGroup.prototype.listens.call(this,"cluster"+t,e)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),i=" marker-cluster-";return e<10?i+="small":e<100?i+="medium":i+="large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+i,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,i=this.options.showCoverageOnHover,s=this.options.zoomToBoundsOnClick,n=this.options.spiderfyOnEveryZoom;(e||s||n)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),i&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){var e=t.layer,i=e;if(!(t.type==="clusterkeypress"&&t.originalEvent&&t.originalEvent.keyCode!==13)){for(;i._childClusters.length===1;)i=i._childClusters[0];i._zoom===this._maxZoom&&i._childCount===e._childCount&&this.options.spiderfyOnMaxZoom?e.spiderfy():this.options.zoomToBoundsOnClick&&e.zoomToBounds(),this.options.spiderfyOnEveryZoom&&e.spiderfy(),t.originalEvent&&t.originalEvent.keyCode===13&&this._map._container.focus()}},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,i=this.options.zoomToBoundsOnClick,s=this.options.spiderfyOnEveryZoom,n=this._map;(t||i||s)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),e&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),n.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=Math.ceil(this._map.getMaxZoom()),e=Math.floor(this._map.getMinZoom()),i=this.options.maxClusterRadius,s=i;typeof i!="function"&&(s=function(){return i}),this.options.disableClusteringAtZoom!==null&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var n=t;n>=e;n--)this._gridClusters[n]=new L.DistanceGrid(s(n)),this._gridUnclustered[n]=new L.DistanceGrid(s(n));this._topClusterLevel=new this._markerCluster(this,e-1)},_addLayer:function(t,e){var i=this._gridClusters,s=this._gridUnclustered,n=Math.floor(this._map.getMinZoom()),r,o;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(t),t.on(this._childMarkerEventHandlers,this);e>=n;e--){r=this._map.project(t.getLatLng(),e);var l=i[e].getNearObject(r);if(l){l._addChild(t),t.__parent=l;return}if(l=s[e].getNearObject(r),l){var a=l.__parent;a&&this._removeLayer(l,!1);var u=new this._markerCluster(this,e,l,t);i[e].addObject(u,this._map.project(u._cLatLng,e)),l.__parent=u,t.__parent=u;var h=u;for(o=e-1;o>a._zoom;o--)h=new this._markerCluster(this,o,h),i[o].addObject(h,this._map.project(l.getLatLng(),o));a._addChild(h),this._removeFromGridUnclustered(l,e);return}s[e].addObject(t,r)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()})},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var t=Math.round(this._map._zoom);this._processQueue(),this._zoom<t&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,t)):this._zoom>t?(this._animationStart(),this._animationZoomOut(this._zoom,t)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(this.options.removeOutsideVisibleBounds){if(L.Browser.mobile)return this._checkBoundsMaxLat(this._map.getBounds())}else return this._mapBoundsInfinite;return this._checkBoundsMaxLat(this._map.getBounds().pad(1))},_checkBoundsMaxLat:function(t){var e=this._maxLat;return e!==void 0&&(t.getNorth()>=e&&(t._northEast.lat=1/0),t.getSouth()<=-e&&(t._southWest.lat=-1/0)),t},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(e._childCount===2){e._addToMap();var i=e.getAllChildMarkers();this._featureGroup.removeLayer(i[0]),this._featureGroup.removeLayer(i[1])}else e._updateIcon()},_extractNonGroupLayers:function(t,e){var i=t.getLayers(),s=0,n;for(e=e||[];s<i.length;s++){if(n=i[s],n instanceof L.LayerGroup){this._extractNonGroupLayers(n,e);continue}e.push(n)}return e},_overrideMarkerIcon:function(t){var e=t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}});return e}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(t,e){var i=this._getExpandedVisibleBounds(),s=this._featureGroup,n=Math.floor(this._map.getMinZoom()),r;this._ignoreMove=!0,this._topClusterLevel._recursively(i,t,n,function(o){var l=o._latlng,a=o._markers,u;for(i.contains(l)||(l=null),o._isSingleParent()&&t+1===e?(s.removeLayer(o),o._recursivelyAddChildrenToMap(null,e,i)):(o.clusterHide(),o._recursivelyAddChildrenToMap(l,e,i)),r=a.length-1;r>=0;r--)u=a[r],i.contains(u._latlng)||s.removeLayer(u)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(i,e),s.eachLayer(function(o){!(o instanceof L.MarkerCluster)&&o._icon&&o.clusterShow()}),this._topClusterLevel._recursively(i,t,e,function(o){o._recursivelyRestoreChildPositions(e)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(i,t,n,function(o){s.removeLayer(o),o.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){var i=this,s=this._featureGroup;s.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.clusterHide(),this._enqueue(function(){s.removeLayer(t),t.clusterShow(),i._animationEnd()})):(this._forceLayout(),i._animationStart(),i._animationZoomOutSingle(e,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(t,e,i){var s=this._getExpandedVisibleBounds(),n=Math.floor(this._map.getMinZoom());t._recursivelyAnimateChildrenInAndAddSelfToMap(s,n,e+1,i);var r=this;this._forceLayout(),t._recursivelyBecomeVisible(s,i),this._enqueue(function(){if(t._childCount===1){var o=t._markers[0];this._ignoreMove=!0,o.setLatLng(o.getLatLng()),this._ignoreMove=!1,o.clusterShow&&o.clusterShow()}else t._recursively(s,i,n,function(l){l._recursivelyRemoveChildrenFromMap(s,n,e+1)});r._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)};var C=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(t,e,i,s){L.Marker.prototype.initialize.call(this,i?i._cLatLng||i.getLatLng():new L.LatLng(0,0),{icon:this,pane:t.options.clusterPane}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,i&&this._addChild(i),s&&this._addChild(s)},getAllChildMarkers:function(t,e){t=t||[];for(var i=this._childClusters.length-1;i>=0;i--)this._childClusters[i].getAllChildMarkers(t,e);for(var s=this._markers.length-1;s>=0;s--)e&&this._markers[s].__dragStart||t.push(this._markers[s]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(t){for(var e=this._childClusters.slice(),i=this._group._map,s=i.getBoundsZoom(this._bounds),n=this._zoom+1,r=i.getZoom(),o;e.length>0&&s>n;){n++;var l=[];for(o=0;o<e.length;o++)l=l.concat(e[o]._childClusters);e=l}s>n?this._group._map.setView(this._latlng,n):s<=r?this._group._map.setView(this._latlng,r+1):this._group._map.fitBounds(this._bounds,t)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_setClusterCenter:function(t){this._cLatLng||(this._cLatLng=t._cLatLng||t._latlng)},_resetBounds:function(){var t=this._bounds;t._southWest&&(t._southWest.lat=1/0,t._southWest.lng=1/0),t._northEast&&(t._northEast.lat=-1/0,t._northEast.lng=-1/0)},_recalculateBounds:function(){var t=this._markers,e=this._childClusters,i=0,s=0,n=this._childCount,r,o,l,a;if(n!==0){for(this._resetBounds(),r=0;r<t.length;r++)l=t[r]._latlng,this._bounds.extend(l),i+=l.lat,s+=l.lng;for(r=0;r<e.length;r++)o=e[r],o._boundsNeedUpdate&&o._recalculateBounds(),this._bounds.extend(o._bounds),l=o._wLatLng,a=o._childCount,i+=l.lat*a,s+=l.lng*a;this._latlng=this._wLatLng=new L.LatLng(i/n,s/n),this._boundsNeedUpdate=!1}},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,i){this._recursively(t,this._group._map.getMinZoom(),i-1,function(s){var n=s._markers,r,o;for(r=n.length-1;r>=0;r--)o=n[r],o._icon&&(o._setPos(e),o.clusterHide())},function(s){var n=s._childClusters,r,o;for(r=n.length-1;r>=0;r--)o=n[r],o._icon&&(o._setPos(e),o.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,i,s){this._recursively(t,s,e,function(n){n._recursivelyAnimateChildrenIn(t,n._group._map.latLngToLayerPoint(n.getLatLng()).round(),i),n._isSingleParent()&&i-1===s?(n.clusterShow(),n._recursivelyRemoveChildrenFromMap(t,e,i)):n.clusterHide(),n._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,this._group._map.getMinZoom(),e,null,function(i){i.clusterShow()})},_recursivelyAddChildrenToMap:function(t,e,i){this._recursively(i,this._group._map.getMinZoom()-1,e,function(s){if(e!==s._zoom)for(var n=s._markers.length-1;n>=0;n--){var r=s._markers[n];i.contains(r._latlng)&&(t&&(r._backupLatlng=r.getLatLng(),r.setLatLng(t),r.clusterHide&&r.clusterHide()),s._group._featureGroup.addLayer(r))}},function(s){s._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var i=this._markers[e];i._backupLatlng&&(i.setLatLng(i._backupLatlng),delete i._backupLatlng)}if(t-1===this._zoom)for(var s=this._childClusters.length-1;s>=0;s--)this._childClusters[s]._restorePosition();else for(var n=this._childClusters.length-1;n>=0;n--)this._childClusters[n]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,i,s){var n,r;this._recursively(t,e-1,i-1,function(o){for(r=o._markers.length-1;r>=0;r--)n=o._markers[r],(!s||!s.contains(n._latlng))&&(o._group._featureGroup.removeLayer(n),n.clusterShow&&n.clusterShow())},function(o){for(r=o._childClusters.length-1;r>=0;r--)n=o._childClusters[r],(!s||!s.contains(n._latlng))&&(o._group._featureGroup.removeLayer(n),n.clusterShow&&n.clusterShow())})},_recursively:function(t,e,i,s,n){var r=this._childClusters,o=this._zoom,l,a;if(e<=o&&(s&&s(this),n&&o===i&&n(this)),o<e||o<i)for(l=r.length-1;l>=0;l--)a=r[l],a._boundsNeedUpdate&&a._recalculateBounds(),t.intersects(a._bounds)&&a._recursively(t,e,i,s,n)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var t=this.options.opacity;return this.setOpacity(0),this.options.opacity=t,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var i=this._getCoord(e.x),s=this._getCoord(e.y),n=this._grid,r=n[s]=n[s]||{},o=r[i]=r[i]||[],l=L.Util.stamp(t);this._objectPoint[l]=e,o.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var i=this._getCoord(e.x),s=this._getCoord(e.y),n=this._grid,r=n[s]=n[s]||{},o=r[i]=r[i]||[],l,a;for(delete this._objectPoint[L.Util.stamp(t)],l=0,a=o.length;l<a;l++)if(o[l]===t)return o.splice(l,1),a===1&&delete r[i],!0},eachObject:function(t,e){var i,s,n,r,o,l,a,u=this._grid;for(i in u){o=u[i];for(s in o)for(l=o[s],n=0,r=l.length;n<r;n++)a=t.call(e,l[n]),a&&(n--,r--)}},getNearObject:function(t){var e=this._getCoord(t.x),i=this._getCoord(t.y),s,n,r,o,l,a,u,h,k=this._objectPoint,c=this._sqCellSize,g=null;for(s=i-1;s<=i+1;s++)if(o=this._grid[s],o){for(n=e-1;n<=e+1;n++)if(l=o[n],l)for(r=0,a=l.length;r<a;r++)u=l[r],h=this._sqDist(k[L.Util.stamp(u)],t),(h<c||h<=c&&g===null)&&(c=h,g=u)}return g},_getCoord:function(t){var e=Math.floor(t/this._cellSize);return isFinite(e)?e:t},_sqDist:function(t,e){var i=e.x-t.x,s=e.y-t.y;return i*i+s*s}},function(){L.QuickHull={getDistant:function(t,e){var i=e[1].lat-e[0].lat,s=e[0].lng-e[1].lng;return s*(t.lat-e[0].lat)+i*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var i=0,s=null,n=[],r,o,l;for(r=e.length-1;r>=0;r--){if(o=e[r],l=this.getDistant(o,t),l>0)n.push(o);else continue;l>i&&(i=l,s=o)}return{maxPoint:s,newPoints:n}},buildConvexHull:function(t,e){var i=[],s=this.findMostDistantPointFromBaseLine(t,e);return s.maxPoint?(i=i.concat(this.buildConvexHull([t[0],s.maxPoint],s.newPoints)),i=i.concat(this.buildConvexHull([s.maxPoint,t[1]],s.newPoints)),i):[t[0]]},getConvexHull:function(t){var e=!1,i=!1,s=!1,n=!1,r=null,o=null,l=null,a=null,u=null,h=null,k;for(k=t.length-1;k>=0;k--){var c=t[k];(e===!1||c.lat>e)&&(r=c,e=c.lat),(i===!1||c.lat<i)&&(o=c,i=c.lat),(s===!1||c.lng>s)&&(l=c,s=c.lng),(n===!1||c.lng<n)&&(a=c,n=c.lng)}i!==e?(h=o,u=r):(h=a,u=l);var g=[].concat(this.buildConvexHull([h,u],t),this.buildConvexHull([u,h],t));return g}}}(),L.MarkerCluster.include({getConvexHull:function(){var t=this.getAllChildMarkers(),e=[],i,s;for(s=t.length-1;s>=0;s--)i=t[s].getLatLng(),e.push(i);return L.QuickHull.getConvexHull(e)}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var t=this.getAllChildMarkers(null,!0),e=this._group,i=e._map,s=i.latLngToLayerPoint(this._latlng),n;this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?n=this._group.options.spiderfyShapePositions(t.length,s):t.length>=this._circleSpiralSwitchover?n=this._generatePointsSpiral(t.length,s):(s.y+=10,n=this._generatePointsCircle(t.length,s)),this._animationSpiderfy(t,n)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var i=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t),s=i/this._2PI,n=this._2PI/t,r=[],o,l;for(s=Math.max(s,35),r.length=t,o=0;o<t;o++)l=this._circleStartAngle+o*n,r[o]=new L.Point(e.x+s*Math.cos(l),e.y+s*Math.sin(l))._round();return r},_generatePointsSpiral:function(t,e){var i=this._group.options.spiderfyDistanceMultiplier,s=i*this._spiralLengthStart,n=i*this._spiralFootSeparation,r=i*this._spiralLengthFactor*this._2PI,o=0,l=[],a;for(l.length=t,a=t;a>=0;a--)a<t&&(l[a]=new L.Point(e.x+s*Math.cos(o),e.y+s*Math.sin(o))._round()),o+=n/s+a*5e-4,s+=r/o;return l},_noanimationUnspiderfy:function(){var t=this._group,e=t._map,i=t._featureGroup,s=this.getAllChildMarkers(null,!0),n,r;for(t._ignoreMove=!0,this.setOpacity(1),r=s.length-1;r>=0;r--)n=s[r],i.removeLayer(n),n._preSpiderfyLatlng&&(n.setLatLng(n._preSpiderfyLatlng),delete n._preSpiderfyLatlng),n.setZIndexOffset&&n.setZIndexOffset(0),n._spiderLeg&&(e.removeLayer(n._spiderLeg),delete n._spiderLeg);t.fire("unspiderfied",{cluster:this,markers:s}),t._ignoreMove=!1,t._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(t,e){var i=this._group,s=i._map,n=i._featureGroup,r=this._group.options.spiderLegPolylineOptions,o,l,a,u;for(i._ignoreMove=!0,o=0;o<t.length;o++)u=s.layerPointToLatLng(e[o]),l=t[o],a=new L.Polyline([this._latlng,u],r),s.addLayer(a),l._spiderLeg=a,l._preSpiderfyLatlng=l._latlng,l.setLatLng(u),l.setZIndexOffset&&l.setZIndexOffset(1e6),n.addLayer(l);this.setOpacity(.3),i._ignoreMove=!1,i.fire("spiderfied",{cluster:this,markers:t})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(t,e){var i=this,s=this._group,n=s._map,r=s._featureGroup,o=this._latlng,l=n.latLngToLayerPoint(o),a=L.Path.SVG,u=L.extend({},this._group.options.spiderLegPolylineOptions),h=u.opacity,k,c,g,v,M,b;for(h===void 0&&(h=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),a?(u.opacity=0,u.className=(u.className||"")+" leaflet-cluster-spider-leg"):u.opacity=h,s._ignoreMove=!0,k=0;k<t.length;k++)c=t[k],b=n.layerPointToLatLng(e[k]),g=new L.Polyline([o,b],u),n.addLayer(g),c._spiderLeg=g,a&&(v=g._path,M=v.getTotalLength()+.1,v.style.strokeDasharray=M,v.style.strokeDashoffset=M),c.setZIndexOffset&&c.setZIndexOffset(1e6),c.clusterHide&&c.clusterHide(),r.addLayer(c),c._setPos&&c._setPos(l);for(s._forceLayout(),s._animationStart(),k=t.length-1;k>=0;k--)b=n.layerPointToLatLng(e[k]),c=t[k],c._preSpiderfyLatlng=c._latlng,c.setLatLng(b),c.clusterShow&&c.clusterShow(),a&&(g=c._spiderLeg,v=g._path,v.style.strokeDashoffset=0,g.setStyle({opacity:h}));this.setOpacity(.3),s._ignoreMove=!1,setTimeout(function(){s._animationEnd(),s.fire("spiderfied",{cluster:i,markers:t})},200)},_animationUnspiderfy:function(t){var e=this,i=this._group,s=i._map,n=i._featureGroup,r=t?s._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):s.latLngToLayerPoint(this._latlng),o=this.getAllChildMarkers(null,!0),l=L.Path.SVG,a,u,h,k,c,g;for(i._ignoreMove=!0,i._animationStart(),this.setOpacity(1),u=o.length-1;u>=0;u--)a=o[u],a._preSpiderfyLatlng&&(a.closePopup(),a.setLatLng(a._preSpiderfyLatlng),delete a._preSpiderfyLatlng,g=!0,a._setPos&&(a._setPos(r),g=!1),a.clusterHide&&(a.clusterHide(),g=!1),g&&n.removeLayer(a),l&&(h=a._spiderLeg,k=h._path,c=k.getTotalLength()+.1,k.style.strokeDashoffset=c,h.setStyle({opacity:0})));i._ignoreMove=!1,setTimeout(function(){var v=0;for(u=o.length-1;u>=0;u--)a=o[u],a._spiderLeg&&v++;for(u=o.length-1;u>=0;u--)a=o[u],a._spiderLeg&&(a.clusterShow&&a.clusterShow(),a.setZIndexOffset&&a.setZIndexOffset(0),v>1&&n.removeLayer(a),s.removeLayer(a._spiderLeg),delete a._spiderLeg);i._animationEnd(),i.fire("unspiderfied",{cluster:e,markers:o})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow(),t.setZIndexOffset&&t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(t){return t?t instanceof L.MarkerClusterGroup?t=t._topClusterLevel.getAllChildMarkers():t instanceof L.LayerGroup?t=t._layers:t instanceof L.MarkerCluster?t=t.getAllChildMarkers():t instanceof L.Marker&&(t=[t]):t=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(t),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(t),this},_flagParentsIconsNeedUpdate:function(t){var e,i;for(e in t)for(i=t[e].__parent;i;)i._iconNeedsUpdate=!0,i=i.__parent},_refreshSingleMarkerModeMarkers:function(t){var e,i;for(e in t)i=t[e],this.hasLayer(i)&&i.setIcon(this._overrideMarkerIcon(i))}}),L.Marker.include({refreshIconOptions:function(t,e){var i=this.options.icon;return L.setOptions(i,t),this.setIcon(i),e&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),f.MarkerClusterGroup=m,f.MarkerCluster=C,Object.defineProperty(f,"__esModule",{value:!0})})})(W,W.exports);const It="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcYBeBeoQIhRAkLlRDGrhIgY3BJL8CVeKzuyXFzzjkn5ZxzzuScg3PO8cKzu70JkO0LfxdTU//pM9vTu7Xgf6KqOVTb9X7toRrVEfBf1HTVjZccrT/2by1VV928Yty9ZbVuucdz90frG8DBjl9pVApbOstvmMuvVgaNXSfAAd6pGxpy6yxf5ph43pS/4f3uoaGm2rdu72S9xzOvMymkZFq/ptDrk90mhW7e4zl7HLzhxGWPR20xmSxJ/VqldG5m9XhaVOA1DadsNh3Pu5L2N6QtPO/32JpqQBVVk20oy/Pi2s23WEvyfHbe1thadVQttvm7Llf65gGmXK67XtupyoM7HQhmXdLS8oGWJNeOJ3C5fG5XCEJnkez3/oFdsvgJ4l2ANZwhrJKk/7OSXa+3Vw2WJMlKnGkobouYk6T0TyX30klOUnTD9HJ5qpckL3EW/w4XF3Xd0FGywXUrstrclVsqz5Pd/sXFYyDnPdrLcQODmGOK47IZb4CmibmMn+MYRzFZ5jg33ZL/EJrWcszHmANy3ARBK/IXtciJy8VsitPSdE3uuHxzougojcUdr8/32atnz/ev3f/K5wtpxUTpcaI45zusVDpYtZi+jg0oU9b3x74h7+n9ABvYEZeKaVq0sh0AtLKsFtqNBdeT0MrSzwwlq9+x6xAO4tgOtSzbCjrNQQiNvQUbUEubvzBUeGw26yDCsRHCoLkTHDa7IdOLIThs/gHvChszh2CimE8peRs47cxANI0lYNB5y1DljpOF0IhzBDPOZnDOqYYbeGKECbPzWnXludPphw5c2YBq5zlwXphIbO4VDCZ0gnPfUO1TwZoYwAs2ExPCedAu9DAjfQUjzITQb3jNj0KG2Sgt6BHaQUdYzWz+XmBktOHwanXjaSTcwwziBcuMOtwBmqPrTOxFQR/DRKKPqyur0aiW6cULYsx6tBm0jXpR/AUWR6HRq9WVW6MRhIq5jLyjbaCTDCijyYJNpCajdyobP/eTw0iexBAKkJ3gA5KcQb2zBXsIBckn+xVv8jkZSaEFHE+jFEleAEfayRU0MouNoBmB/L50Ai/HSLIHxcrpCvnhSQAuakKp2C/YbCylJjXRVy/z3+Kv/RrNcCo+WUzlVEhzKffnTQnxeN9fWF88fiNCUdSTsaufaChKWInHeysygfpIqagoakW+vV20J8uyl6TyNKEZWV4oRSPyCkWpgOLSbkCObT8o2r6tlG58HQquf6O0v50tB7JM7F4EORd2dx/K0w/KHsVkLPaoYrwgP/y7krr3SSMA4zj+OBgmjYkxcdIJQyQRKgg2viX9Hddi9UBb29LrKR7CVVEEEXWojUkXNyfTNDE14W9gbHJNuhjDettN3ZvbOvdOqCD3Jp/9l+/wJE+9PkYGjx/fqkys3S2rMozM/o2106rfMUINo6hVqz+eu/hd1c4xTg0TAfy5kV+4UG6+IthHTU9woWmxuKNbTfuCSfovBCxq7EtHqvYL4Sm6F8GVxsSXHMQ07TOi1DKtZxjWaaIyi4CXWjxPccUw8WVbMYY5wxC1mzEyXMJWkllpRloi+Kkoq69sxBTlElF6aAxYUbjXNlhlDZilDnM4U5SlN5biRsRHnbx3mbeWjEh4mEyiuJDl5XcWVmX5GvNkFgLWZM5qwsop4/AWfLhU1cR7k1VVvcYCWRkOI6Xy5gmnphCYIkvzuNYzHzosq2oNk2RtSs8khfUOfHIDgR6ysYBaMpl4uEgk2U/oJTs9AaTSwma7dT69geAE2ZpEjUsn2ieJNHeKfrI3EcAGJ2ZaNgVuC8EBctCLc57P5u5led6IOBkIYkuQMrmmjChs4VkfOerHqSBkPzZlhe06RslZ3zMjk2sscqKwY0RcjKK+LWbzd7KiHhkncs/siFJ+V5eXxD34B8nVuJEpGJNmxN2gH3vSvp7J70tF+D1Ej8qUJD1TkErAND2GZwTFg/LubvmgiBG3SOvdlsqFQrkEzJCL1rstlnVFROixZoDDSuXQFHESwVGlcuQcMb/b42NgjLowh5MTDFE3vNB5qStRIErdCQEh6pLPR92anSUb/wAIhldAaDMpGgAAAABJRU5ErkJggg==";const Et={class:"map-heatmap"},zt={class:"map-controls"},At={class:"view-toggle"},Zt={key:0,class:"density-control"},Gt={key:1,class:"cluster-control"},Nt={key:0,class:"map-legend"},Tt={class:"map-stats"},Ut={class:"stat-item"},Rt={class:"stat-value"},Vt={class:"stat-item"},Dt={class:"stat-value"},jt={key:0,class:"stat-item"},Ft={class:"stat-value"},Ht=["id"],Jt={__name:"MapHeatmap",props:{restaurants:{type:Array,required:!0},loading:{type:Boolean,default:!1},selectedStars:{type:Array,default:()=>[1,2,3]},selectedRegion:{type:String,default:null}},emits:["restaurant-click","view-change"],setup(d,{emit:_}){delete I.Icon.Default.prototype._getIconUrl,I.Icon.Default.mergeOptions({iconRetinaUrl:It,iconUrl:Pt,shadowUrl:Bt});const f=d,m=_,C=B(`map-${Date.now()}-${Math.random().toString(36).substr(2,9)}`);let t=null,e=null,i=null,s=null;const n=B("markers"),r=B(25),o=B(50),l=B(0),a=B(0),u=D(()=>f.restaurants.filter(w=>{const y=f.selectedStars.includes(w.stars),O=!f.selectedRegion||w.region===f.selectedRegion;return y&&O&&w.latitude&&w.longitude})),h=D(()=>({markers:"标记点模式",heatmap:"热力图模式",cluster:"聚合模式"})[n.value]),k=async()=>{await ut(),document.getElementById(C.value)&&(t=I.map(C.value,{center:[40,0],zoom:2,zoomControl:!0,attributionControl:!1}),I.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors",maxZoom:18}).addTo(t),e=I.layerGroup(),s=I.markerClusterGroup({maxClusterRadius:o.value,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0}),c())},c=()=>{if(t){switch(g(),n.value){case"markers":v();break;case"heatmap":M();break;case"cluster":b();break}if(u.value.length>0){const w=I.latLngBounds(u.value.map(y=>[y.latitude,y.longitude]));t.fitBounds(w,{padding:[20,20]})}}},g=()=>{e&&(e.clearLayers(),t.removeLayer(e)),i&&(t.removeLayer(i),i=null),s&&(s.clearLayers(),t.removeLayer(s))},v=()=>{e.clearLayers(),u.value.forEach(w=>{const y=A(w);e.addLayer(y)}),t.addLayer(e),l.value=u.value.length},M=()=>{const w=u.value.map(y=>{const O=y.stars===3?1:y.stars===2?.6:.3;return[y.latitude,y.longitude,O]});i=I.heatLayer(w,{radius:r.value,blur:10,maxZoom:15,minOpacity:.6,max:1,gradient:{.1:"rgba(0, 100, 255, 0.7)",.3:"rgba(0, 180, 255, 0.8)",.5:"rgba(0, 255, 150, 0.8)",.7:"rgba(255, 200, 0, 0.9)",.9:"rgba(255, 100, 0, 0.95)",1:"rgba(255, 0, 0, 1.0)"}}).addTo(t),l.value=u.value.length},b=()=>{s.options.maxClusterRadius=o.value,s.clearLayers(),u.value.forEach(w=>{const y=A(w);s.addLayer(y)}),t.addLayer(s),l.value=u.value.length,a.value=s.getLayers().length},A=w=>{const{latitude:y,longitude:O,stars:T,name:U,city:S,region:Z,cuisine:et,price:q}=w,G=(nt=>{const K={1:{color:"#10b981",size:12},2:{color:"#f59e0b",size:16},3:{color:"#ef4444",size:20}};return K[nt]||K[1]})(T),it=I.divIcon({html:`<div style="
      background-color: ${G.color};
      width: ${G.size}px;
      height: ${G.size}px;
      border-radius: 50%;
      border: 2px solid white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: ${Math.max(8,G.size-6)}px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s ease;
    " onmouseover="this.style.transform='scale(1.2)'" 
       onmouseout="this.style.transform='scale(1)'">${T}</div>`,className:"custom-marker",iconSize:[G.size,G.size],iconAnchor:[G.size/2,G.size/2]}),J=I.marker([y,O],{icon:it}),st=`
    <div class="restaurant-popup">
      <h3 class="popup-title">${U}</h3>
      <div class="popup-details">
        <div class="detail-item">
          <strong>⭐ ${T}星米其林餐厅</strong>
        </div>
        <div class="detail-item">
          📍 ${S||""}${S&&Z?", ":""}${Z||""}
        </div>
        <div class="detail-item">
          🍽️ ${et||"未知菜系"}
        </div>
        ${q?`<div class="detail-item">💰 ${q}</div>`:""}
      </div>
      <div class="popup-actions">
        <button class="detail-btn" onclick="window.showRestaurantDetail('${w.id}')">
          查看详情
        </button>
      </div>
    </div>
  `;return J.bindPopup(st,{maxWidth:300,className:"custom-popup"}),J.on("click",()=>{m("restaurant-click",w)}),J},j=w=>{n.value=w,c(),m("view-change",w)},F=()=>{n.value==="heatmap"&&(g(),M())},H=()=>{n.value==="cluster"&&(g(),b())};return Q(()=>[f.restaurants,f.selectedStars,f.selectedRegion],()=>{t&&c()},{deep:!0}),$(()=>{k(),window.showRestaurantDetail=w=>{const y=f.restaurants.find(O=>O.id===w);y&&m("restaurant-click",y)}}),at(()=>{t&&(t.remove(),t=null),window.showRestaurantDetail&&delete window.showRestaurantDetail}),(w,y)=>{const O=ht,T=dt,U=_t,S=ct;return z(),N("div",Et,[p("div",zt,[p("div",At,[x(T,{modelValue:n.value,"onUpdate:modelValue":y[0]||(y[0]=Z=>n.value=Z),onChange:j},{default:P(()=>[x(O,{label:"markers"},{default:P(()=>y[3]||(y[3]=[R("标记点")])),_:1,__:[3]}),x(O,{label:"heatmap"},{default:P(()=>y[4]||(y[4]=[R("热力图")])),_:1,__:[4]}),x(O,{label:"cluster"},{default:P(()=>y[5]||(y[5]=[R("聚合")])),_:1,__:[5]})]),_:1},8,["modelValue"])]),n.value==="heatmap"?(z(),N("div",Zt,[y[6]||(y[6]=p("span",null,"密度调节",-1)),x(U,{modelValue:r.value,"onUpdate:modelValue":y[1]||(y[1]=Z=>r.value=Z),min:10,max:50,onChange:F,style:{width:"120px","margin-left":"12px"}},null,8,["modelValue"])])):V("",!0),n.value==="cluster"?(z(),N("div",Gt,[y[7]||(y[7]=p("span",null,"聚合距离",-1)),x(U,{modelValue:o.value,"onUpdate:modelValue":y[2]||(y[2]=Z=>o.value=Z),min:20,max:100,onChange:H,style:{width:"120px","margin-left":"12px"}},null,8,["modelValue"])])):V("",!0)]),n.value==="heatmap"?(z(),N("div",Nt,y[8]||(y[8]=[p("div",{class:"legend-title"},"餐厅密度",-1),p("div",{class:"legend-gradient"},[p("div",{class:"gradient-bar"}),p("div",{class:"gradient-labels"},[p("span",null,"低"),p("span",null,"中"),p("span",null,"高")])],-1)]))):V("",!0),p("div",Tt,[p("div",Ut,[y[9]||(y[9]=p("span",{class:"stat-label"},"显示模式:",-1)),p("span",Rt,E(h.value),1)]),p("div",Vt,[y[10]||(y[10]=p("span",{class:"stat-label"},"可见点数:",-1)),p("span",Dt,E(l.value),1)]),n.value==="cluster"?(z(),N("div",jt,[y[11]||(y[11]=p("span",{class:"stat-label"},"聚合组数:",-1)),p("span",Ft,E(a.value),1)])):V("",!0)]),lt(p("div",{id:C.value,class:"map-container","element-loading-text":"正在加载地图..."},null,8,Ht),[[S,d.loading]])])}}},qt=tt(Jt,[["__scopeId","data-v-5092ab1d"]]);const Kt={class:"map-view"},Xt={class:"map-container"},Yt={class:"card"},Wt={class:"card-body"},Qt={class:"map-controls"},$t={class:"card"},te={class:"card-header"},ee={class:"card-subtitle"},ie={class:"card-body"},se={class:"stats-grid"},ne={class:"stat-card"},oe={class:"stat-number"},re={class:"stat-card"},ae={class:"stat-number"},le={class:"stat-card"},ue={class:"stat-number"},he={class:"stat-card"},de={class:"stat-number"},_e={class:"card"},ce={class:"card-body"},fe={__name:"MapView",setup(d){const _=ot(),f=D(()=>_.loading),m=B(null),C=B([]),t=B([]),e=B(JSON.parse(localStorage.getItem("mapFilters_stars")||"[1, 2, 3]")),i=B(localStorage.getItem("mapFilters_region")||null),s=D(()=>C.value.filter(g=>{const v=e.value.includes(g.stars),M=!i.value||g.region===i.value;return v&&M&&g.latitude&&g.longitude})),n=B({totalRestaurants:0,countries:0,cities:0,continents:0}),r=B([]),o=()=>{localStorage.setItem("mapFilters_stars",JSON.stringify(e.value)),localStorage.setItem("mapFilters_region",i.value||"")},l=g=>{mt({message:`选中餐厅: ${g.name}`,type:"info",duration:2e3})},a=g=>{console.log("地图视图切换到:",g)},u=async()=>{try{if(f.value=!0,await _.fetchGeoJSON(),m.value=_.geojson,m.value&&m.value.features){C.value=m.value.features.map(v=>{const M=v.properties,b=v.geometry.coordinates;return{id:M.id,name:M.name,stars:Number(M.stars)||0,city:M.city,region:M.region,continent:M.continent,cuisine:M.cuisine,price:M.price,latitude:b[1],longitude:b[0],year:M.year,website:M.website||M.url}}),console.log(`成功加载${C.value.length}家餐厅数据`);const g=[...new Set(C.value.map(v=>v.region).filter(Boolean))];t.value=g.sort(),k()}else console.error("无法获取地理数据或数据格式不正确")}catch(g){console.error("获取地图数据失败:",g)}finally{f.value=!1}},h=()=>{o()},k=()=>{const g=C.value;if(!g.length){console.warn("无法计算统计数据：没有加载餐厅数据");return}n.value={totalRestaurants:g.length,countries:[...new Set(g.map(M=>M.region).filter(Boolean))].length,cities:[...new Set(g.map(M=>M.city).filter(Boolean))].length,continents:[...new Set(g.map(M=>M.continent).filter(Boolean))].length},console.log("地理统计数据:",n.value);const v={};g.forEach(M=>{const b=M.region||"未知";v[b]||(v[b]={star1:0,star2:0,star3:0,total:0}),v[b].total++,v[b][`star${M.stars}`]++}),r.value=Object.entries(v).map(([M,b])=>({region:M,...b,percentage:(b.total/g.length*100).toFixed(1)})).sort((M,b)=>b.total-M.total)},c=()=>{e.value=[1,2,3],i.value=null,h()};return Q([e,i],()=>{o()},{deep:!0}),$(async()=>{try{console.log("开始加载地图数据..."),await u(),console.log(`地图数据加载完成: 总共 ${C.value.length} 家餐厅`)}catch(g){console.error("地图数据加载失败:",g)}}),(g,v)=>{const M=gt,b=vt,A=Lt,j=Ot,F=yt,H=Ct,w=Mt,y=kt,O=bt,T=wt,U=xt;return z(),N("div",Kt,[p("div",Xt,[v[10]||(v[10]=p("div",{class:"page-header"},[p("h1",{class:"page-title"},"地图分析"),p("p",{class:"page-subtitle"},"全球米其林餐厅地理分布可视化")],-1)),p("div",Yt,[v[3]||(v[3]=p("div",{class:"card-header"},[p("h3",{class:"card-title"},"地图筛选")],-1)),p("div",Wt,[p("div",Qt,[x(y,{inline:""},{default:P(()=>[x(A,{label:"星级筛选"},{default:P(()=>[x(b,{modelValue:e.value,"onUpdate:modelValue":v[0]||(v[0]=S=>e.value=S),onChange:h},{default:P(()=>[(z(),N(X,null,Y([1,2,3],S=>x(M,{key:S,label:S},{default:P(()=>[R(E(S)+"星 ",1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),x(A,{label:"地区筛选"},{default:P(()=>[x(F,{modelValue:i.value,"onUpdate:modelValue":v[1]||(v[1]=S=>i.value=S),placeholder:"全部地区",clearable:"",onChange:h,style:{width:"200px"}},{default:P(()=>[(z(!0),N(X,null,Y(t.value,S=>(z(),ft(j,{key:S,label:S,value:S},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),x(A,null,{default:P(()=>[x(w,{onClick:c},{default:P(()=>[x(H,null,{default:P(()=>[x(pt(St))]),_:1}),v[2]||(v[2]=R(" 重置筛选 "))]),_:1,__:[2]})]),_:1})]),_:1})])])]),p("div",$t,[p("div",te,[v[4]||(v[4]=p("h3",{class:"card-title"},"全球分布地图",-1)),p("p",ee,E(s.value.length)+" 家餐厅分布在全球各地 ",1)]),p("div",ie,[x(qt,{restaurants:s.value,loading:f.value,"selected-stars":e.value,"selected-region":i.value,onRestaurantClick:l,onViewChange:a},null,8,["restaurants","loading","selected-stars","selected-region"])])]),p("div",se,[p("div",ne,[p("div",oe,E(n.value.totalRestaurants),1),v[5]||(v[5]=p("div",{class:"stat-label"},"总餐厅数",-1))]),p("div",re,[p("div",ae,E(n.value.countries),1),v[6]||(v[6]=p("div",{class:"stat-label"},"覆盖国家",-1))]),p("div",le,[p("div",ue,E(n.value.cities),1),v[7]||(v[7]=p("div",{class:"stat-label"},"覆盖城市",-1))]),p("div",he,[p("div",de,E(n.value.continents),1),v[8]||(v[8]=p("div",{class:"stat-label"},"覆盖大陆",-1))])]),p("div",_e,[v[9]||(v[9]=p("div",{class:"card-header"},[p("h3",{class:"card-title"},"地区分布统计")],-1)),p("div",ce,[x(U,{data:r.value,stripe:"",style:{width:"100%"}},{default:P(()=>[x(O,{prop:"region",label:"地区","min-width":"150"}),x(O,{prop:"total",label:"总数",width:"80",align:"center"}),x(O,{prop:"star1",label:"1星",width:"60",align:"center"}),x(O,{prop:"star2",label:"2星",width:"60",align:"center"}),x(O,{prop:"star3",label:"3星",width:"60",align:"center"}),x(O,{prop:"percentage",label:"占比",width:"80",align:"center"},{default:P(S=>[R(E(S.row.percentage)+"% ",1)]),_:1}),x(O,{label:"分布条","min-width":"150"},{default:P(S=>[x(T,{percentage:S.row.percentage,"stroke-width":12,"show-text":!1},null,8,["percentage"])]),_:1})]),_:1},8,["data"])])])])])}}},xe=tt(fe,[["__scopeId","data-v-5906fc32"]]);export{xe as default};
